#!/usr/bin/env bash

# Exit early if smartctl is not installed
if ! command -v smartctl &> /dev/null; then
    exit 0
fi

sd=(sda sdb sdc sdd)
out=""
COLUMNS=4
clear="\e[0m\e[39m"

my_target_temp=45
has_temps=false

for i in "${!sd[@]}"; do
    temp=$(smartctl -a "/dev/${sd[$i]}" 2>/dev/null | grep Temperature_Celsius | grep 194 | awk '{print $10}')
    
    # Skip if no temperature reading
    if [[ -z "$temp" ]]; then
        continue
    fi
    
    has_temps=true
    color="\e[42m"
    if [ "$temp" -ge "${my_target_temp}" ]; then
        color="\e[41m"
    fi
    out+="${sd[$i]} \e[30m $color $tempÂ°C $clear ,"
    if [ $(((i+1) % COLUMNS)) -eq 0 ]; then
        out+="\n"
    fi
done

# Only display if we found any temperatures
if [[ "$has_temps" == true ]]; then
    out+="\n"
    echo -e "\nHDD Temps:"
    printf "$out" | column -ts $',' | sed -e 's/^/  /'
fi
